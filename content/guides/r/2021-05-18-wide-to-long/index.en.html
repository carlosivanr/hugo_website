---
title: Converting wide to long data
author: Carlos Rodriguez
date: '2021-05-18'
slug: wide-to-long
categories:
  - data wrangling
tags:
subtitle: ''
summary: ''
authors: []
lastmod: '2021-05-18T22:08:51-06:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
draft: false
type: book

---



<p>This guide explains how to convert a wide dataset to long using tidyverse. The data are from the AMCP package and were created to run a two-way repeated measures ANOVA. While some statistical packages can indeed perform the aforementioned analysis on wide data, others will require long-format data including rstatix and base R.</p>
<pre class="r"><code>library(tidyverse)
library(AMCP)

# Load the data
data(chapter_12_table_1)</code></pre>
<div id="wide-data" class="section level2">
<h2>Wide Data</h2>
<p>In the wide format data, each row represents a subject In the example, each contains data for one participant and each column represents one of six different measurements. Each column is a combination of two factors, Absent or Present as levels of the first factors, and 0, 4, or 8 as levels of the second factor. The design is from a 2 x 3 repeated measures design.</p>
<pre class="r"><code># Display the data
chapter_12_table_1</code></pre>
<pre><code>##    Absent0 Absent4 Absent8 Present0 Present4 Present8
## 1      420     420     480      480      600      780
## 2      420     480     480      360      480      600
## 3      480     480     540      660      780      780
## 4      420     540     540      480      780      900
## 5      540     660     540      480      660      720
## 6      360     420     360      360      480      540
## 7      480     480     600      540      720      840
## 8      480     600     660      540      720      900
## 9      540     600     540      480      720      780
## 10     480     420     540      540      660      780</code></pre>
</div>
<div id="long-data" class="section level2">
<h2>Long Data</h2>
<p>In the long data format, each row represents an observation. Instead of having six columns with all of the dependent variables in one row, we want all of our dependent variables in one column. In addition, we will want additional columns that will contain the information that was specified by the column names. Notice that the values in 1st row of the wide data are now the first six values in the new column “Reaction_Time.” So one way to think about this conversion is that we are going to take the values of each row, transpose the row to convert it to column, and then begin to concatenate or stack the remaining rows. At the same time, we will want to keep information about Condition wether noise was present or absent, and the angle at wich a stimulus was presented.</p>
<pre class="r"><code>head(rm_data)</code></pre>
<pre><code>##   Condition Angle Reaction_Time
## 1    Absent     0           420
## 2    Absent     4           420
## 3    Absent     8           480
## 4   Present     0           480
## 5   Present     4           600
## 6   Present     8           780</code></pre>
</div>
<div id="converting-wide-to-long" class="section level2">
<h2>Converting Wide to Long</h2>
<div id="create-a-subject-id" class="section level3">
<h3>1. Create a subject id</h3>
<p>To make this transformation we will use the tidyverse functions. First, we will want to keep track of our 10 subjects so we will create a column “id” with an integer to identify them, then bind that column to the wide data to create a new dataframe.</p>
<pre class="r"><code>#1. Create a new data frame with a subject id
long.data &lt;- cbind(id = c(1:10), chapter_12_table_1)</code></pre>
</div>
<div id="gather-dependent-variables" class="section level3">
<h3>2. Gather dependent variables</h3>
<p>Next, we will use the <code>gather()</code> function which will stack each column of the wide data under a column called reaction_time and create a new column that will add the column name of the wide data as a value in a new column called condition.angle. The <code>-id</code> is used to prevent getting the id number into the condition.angle column.</p>
<pre class="r"><code>head(long.data %&gt;% gather(key = condition.angle,
                     value = reaction_time, -id)
)</code></pre>
<pre><code>##   id condition.angle reaction_time
## 1  1         Absent0           420
## 2  2         Absent0           420
## 3  3         Absent0           480
## 4  4         Absent0           420
## 5  5         Absent0           540
## 6  6         Absent0           360</code></pre>
</div>
<div id="separate-characters" class="section level3">
<h3>3. Separate characters</h3>
<p>So far we’re on a good track, but the column condition.angle should be two. One to specify condition, and the other to specify angle. The <code>separate()</code> function can help split the one column into two. It will essentially separate <code>condition.angle</code> into <code>condition</code> and <code>angle</code>. The <code>sep = -1</code> argument tells the <code>separate()</code> function to split the values 1 character from the end. This separates the last character which contains an angle number into a separate column. Try substituting different numbers such as -2 or 1, to get a feel for what the function is doing here.</p>
<pre class="r"><code>head(long.data %&gt;% gather(key = condition.angle,
                     value = reaction_time, 
                     -id) %&gt;%
  separate(col = condition.angle, 
           into = c(&quot;condition&quot;, &quot;angle&quot;), 
           sep = -1)
)</code></pre>
<pre><code>##   id condition angle reaction_time
## 1  1    Absent     0           420
## 2  2    Absent     0           420
## 3  3    Absent     0           480
## 4  4    Absent     0           420
## 5  5    Absent     0           540
## 6  6    Absent     0           360</code></pre>
</div>
<div id="sort-the-data" class="section level3">
<h3>4. Sort the data</h3>
<p>At this point, we’ve done most of what is needed to convert the wide data to long data. The next layer in the series of tidyverse functions is to sort the data. To get the output displayed above, we will want to sort the data by subject id, then by condition, then by angle. To accomplish this we will use the <code>arrange()</code> function an will display the reaction_time values as a column of the transposed rows from the wide data set. We will re-save this manipulation as long.data. Notice how the number of data frames is now 60 whereas we started with 10.</p>
<pre class="r"><code>long.data &lt;- long.data %&gt;% gather(key = condition.angle,
                     value = reaction_time, 
                     -id) %&gt;%
  separate(col = condition.angle, 
           into = c(&quot;condition&quot;, &quot;angle&quot;), 
           sep = -1) %&gt;%
      arrange(id, 
          condition, 
          angle)

head(long.data)</code></pre>
<pre><code>##   id condition angle reaction_time
## 1  1    Absent     0           420
## 2  1    Absent     4           420
## 3  1    Absent     8           480
## 4  1   Present     0           480
## 5  1   Present     4           600
## 6  1   Present     8           780</code></pre>
</div>
<div id="convert-to-factor" class="section level3">
<h3>5. Convert to factor</h3>
<p>Now before conducting any statistical tests, we will want to conver our id, condition, and angle columns to factor. We can do this with the base R function <code>as.factor()</code>.</p>
<pre class="r"><code>long.data$id &lt;- as.factor(long.data$id)
long.data$condition &lt;- as.factor(long.data$condition)
long.data$angle &lt;- as.factor(long.data$angle)</code></pre>
</div>
<div id="bonus-with-other-helper-functions" class="section level3">
<h3>Bonus with other helper functions</h3>
<p>We could also do this with an additional function, <code>convert_as_factor()</code> from the rstatix package. Instead of typing out the commands to convert the columns to factor, we add another piped function at the end of the layers we’ve built.</p>
<pre class="r"><code>library(rstatix)
# Create a new data frame with a subject id
rm_data &lt;- cbind(id = c(1:10), chapter_12_table_1)

# Convert the data from wide to long
rm_data &lt;-  rm_data %&gt;% 
  gather(key = Condition.Angle, 
         value = Reaction_Time, 
         -id) %&gt;%
  separate(col = Condition.Angle, 
           into = c(&quot;Condition&quot;, &quot;Angle&quot;), 
           sep = -1) %&gt;%
  arrange(id, 
          Condition, 
          Angle) %&gt;%
  convert_as_factor(id, Condition, Angle)

# Display the example long data
head(rm_data %&gt;% select(-id))</code></pre>
<pre><code>##   Condition Angle Reaction_Time
## 1    Absent     0           420
## 2    Absent     4           420
## 3    Absent     8           480
## 4   Present     0           480
## 5   Present     4           600
## 6   Present     8           780</code></pre>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2>Wrap Up</h2>
<p>Converting wide data to long and vice versa are indespensible skills when working in R. It can be tricky at first, but thankfully the tidyverse package as several functions that can simplify this process. Going from wide to long will smooth preparing your data so that you can perform the statistical analyses that you’re probably interested in doing.</p>
<div id="references" class="section level3">
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-rstatix">
<p>Kassambara, Alboukadel. 2020a. <em>Rstatix: Pipe-Friendly Framework for Basic Statistical Tests</em>. <a href="https://CRAN.R-project.org/package=rstatix" class="uri">https://CRAN.R-project.org/package=rstatix</a>.</p>
</div>
<div id="ref-R-AMCP">
<p>Maxwell, Scott, Harold Delaney, and Ken Kelley. 2020. <em>AMCP: A Model Comparison Perspective</em>. <a href="https://CRAN.R-project.org/package=AMCP" class="uri">https://CRAN.R-project.org/package=AMCP</a>.</p>
</div>
<div id="ref-R-tidyverse">
<p>Wickham, Hadley. 2019. <em>Tidyverse: Easily Install and Load the ’Tidyverse’</em>. <a href="https://CRAN.R-project.org/package=tidyverse" class="uri">https://CRAN.R-project.org/package=tidyverse</a>.</p>
</div>
</div>
</div>
</div>
